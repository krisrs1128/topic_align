filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., score %>%  filter(m == this_m), by = c("m", "branch"))
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch"))
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores =
aligned_topics$topics_order %>%
select(m, branch) %>%
arrange(branch, m) %>%
group_by(branch) %>%
slice_head(n = 1) %>%
ungroup() %>%
mutate(score = 1) %>%
arrange(m)
alignment = aligned_topics$gamma_alignment
for(this_m in unique(alignment$m) %>% sort()){
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
}
scores
scores =
aligned_topics$topics_order %>%
select(m, branch) %>%
arrange(branch, m) %>%
group_by(branch) %>%
slice_head(n = 1) %>%
ungroup() %>%
mutate(score = 1) %>%
arrange(m)
alignment = aligned_topics$gamma_alignment
this_m = 1
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m = 2
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
this_m_scores
bind_rows(scores, this_m_scores) %>% arrange(m, branch)
this_m
this_m = 3
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight)
scores %>%  filter(m == this_m)
scores
this_m_scores
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores %>%  filter(m == this_m)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch"))
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
scores =
aligned_topics$topics_order %>%
select(m, branch) %>%
arrange(branch, m) %>%
group_by(branch) %>%
slice_head(n = 1) %>%
ungroup() %>%
mutate(score = 1) %>%
arrange(m)
alignment = aligned_topics$gamma_alignment
this_m = 1
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m
this_m = 2
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
this_m_scores
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m
this_m = 3
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight)
scores %>%  filter(m == this_m), by = c("m", "branch")
scores %>%  filter(m == this_m)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch"))
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
this_m_scores =
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores
bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m_scores
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m
unique(alignment$m) %>% sort()
this_m
this_m = 4
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>%
select(m, m_next, branch, branch_next, norm_weight)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next)
alignment %>%
filter(m == this_m) %>%
filter(branch == branch_next) %>% view()
alignment = aligned_topics$gamma_alignment
alignment_along_branches =
alignment %>%
filter(branch == branch_next) %>%
group_by(m, branch, branch_next, topic_next) %>%
summarize(norm_weight = sum(norm_weight), .groups = "drop") %>%
group_by(m, branch, branch_next) %>%
summarize(norm_weight = mean(norm_weight), .groups = "drop")
alignment_along_branches
alignment_along_branches =
alignment %>%
filter(branch == branch_next) %>%
group_by(m, m_next, branch, branch_next, topic_next) %>%
summarize(norm_weight = sum(norm_weight), .groups = "drop") %>%
group_by(m, m_next, branch, branch_next) %>%
summarize(norm_weight = mean(norm_weight), .groups = "drop")
dim(alignment)
dim(alignment_along_branches)
alignment_along_branches
alignment_along_branches =
alignment %>%
filter(branch == branch_next) %>%
group_by(m, m_next, branch, branch_next, topic_next) %>%
summarize(norm_weight = sum(norm_weight), .groups = "drop") %>%
group_by(m, m_next, branch, branch_next) %>%
summarize(norm_weight = mean(norm_weight), .groups = "drop")
scores =
aligned_topics$topics_order %>%
select(m, branch) %>%
arrange(branch, m) %>%
group_by(branch) %>%
slice_head(n = 1) %>%
ungroup() %>%
mutate(score = 1) %>%
arrange(m)
this_m
this_m = 1
alignment_along_branches %>%
filter(m == this_m)
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch"))
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score)
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
this_m_scores =
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
this_m
this_m = 2
this_m_scores =
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
scores
scores =
aligned_topics$topics_order %>%
select(m, branch) %>%
arrange(branch, m) %>%
group_by(branch) %>%
slice_head(n = 1) %>%
ungroup() %>%
mutate(score = 1) %>%
arrange(m)
for(this_m in unique(alignment$m) %>% sort()){
this_m_scores =
alignment_along_branches %>%
filter(m == this_m) %>%
left_join(., scores %>%  filter(m == this_m), by = c("m", "branch")) %>%
mutate(score = score * norm_weight) %>%
select(m_next, branch, score) %>%
dplyr::rename(m = m_next)
scores = bind_rows(scores, this_m_scores) %>% arrange(m, branch)
}
scores
scores %>% view()
ggplot(scores,
aes(x = m, y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
ggplot(scores,
aes(x = m, y = branch, fill = score)) +
geom_tile()
ggplot(scores,
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "red", high = "steelblue")
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line() + facet_grid(. ~ branch)
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
source('~/Documents/Work/Ladies & Gentlemen/Packages/topic_align/R_LSY/score_along_branches.R')
rm(scores)
source('~/Documents/Work/Ladies & Gentlemen/Packages/topic_align/R_LSY/score_along_branches.R')
scores = compute_score_along_branches(aligned_topics = aligned_topics)
ggplot(scores,
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "red", high = "steelblue")
ggplot(scores,
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "steelblue")
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
ggplot(scores %>%
arrange(branch, m) %>%
group_by(branch) %>%
mutate(first_m = first(m)) %>%
ungroup() %>%
arrange(first_m) %>%
mutate(branch = branch %>% factor(., unique(branch))),
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "steelblue")
topic_models_dir = "lda_models/"
lda_models =
run_lda_models(
data = vm_16s,
Ks = 1:16,
method = "VEM",
seed = 2,
dir = topic_models_dir
)
names(lda_models)
head(lda_models$betas)
head(lda_models$gammas)
aligned_topics =
align_topics(
lda_models = lda_models
)
ggplot(aligned_topics$topics_order, aes(x = m, y = k, col = k_LDA)) +
geom_text(aes(label = k_LDA)) + guides(col = FALSE)
ggplot(aligned_topics$topics_order, aes(x = m, y = k, col = k_LDA)) +
geom_text(aes(label = k_LDA)) + guides(col = FALSE)
ggplot(aligned_topics$topics_order, aes(x = m, y = k, col = k_LDA)) +
geom_text(aes(label = k_LDA)) + guides(col = FALSE)
ggplot(aligned_topics$topics_order, aes(x = m, y = k, col = k_LDA)) +
geom_text(aes(label = k_LDA)) + guides(col = FALSE)
g_aligned_topics =
visualize_aligned_topics(
aligned_topics = aligned_topics,
add_leaves = TRUE,
min_beta = 0.05,
add_words_labels = TRUE
)
g_aligned_topics
aligned_topics_with_c =
align_topics(
lda_models = lda_models,
order_constrain = tibble(m = 13 %>% factor(., levels = 1:13),
k_LDA = letters[1:13],
k = c(1,2,3,4,5,9,10,11,12,13,14,17,18))
)
aligned_topics_with_c =
align_topics(
lda_models = lda_models,
order_constrain = tibble(m = 13 %>% factor(., levels = 1:16),
k_LDA = letters[1:13],
k = c(1,2,3,4,5,9,10,11,12,13,14,17,18))
)
g_aligned_topics_with_c =
visualize_aligned_topics(
aligned_topics = aligned_topics_with_c,
add_leaves = TRUE,
min_beta = 0.05,
add_words_labels = TRUE
)
g_aligned_topics_with_c
aligned_topics_with_c =
align_topics(
lda_models = lda_models,
order_constrain = tibble(m = 16 %>% factor(., levels = 1:16),
k_LDA = letters[1:16],
k = c(1,2,3,4,5,9,10,11,12,13,14,17,18, 21,22,23))
)
g_aligned_topics_with_c =
visualize_aligned_topics(
aligned_topics = aligned_topics_with_c,
add_leaves = TRUE,
min_beta = 0.05,
add_words_labels = TRUE
)
g_aligned_topics_with_c
scores = compute_score_along_branches(aligned_topics = aligned_topics)
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor(., levels = 1:18))) +
geom_line()
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor())) +
geom_line()
ggplot(scores %>%
arrange(branch, m) %>%
group_by(branch) %>%
mutate(first_m = first(m)) %>%
ungroup() %>%
arrange(first_m) %>%
mutate(branch = branch %>% factor(., unique(branch))),
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "steelblue")
scores
scores %>%
group_by(m) %>%
summarize(score = mean(score)) %>%
ggplot(aes(x = m %>% as.numeric(), y = score))
scores %>%
group_by(m) %>%
summarize(score = mean(score)) %>%
ggplot(aes(x = m %>% as.numeric(), y = score)) + geom_line()
scores %>%
group_by(m) %>%
summarize(score = mean(score)) %>%
ggplot(aes(x = m %>% as.numeric(), y = score)) + geom_line() +
scale_x_continuous(breaks = 1:16)
scores %>%
group_by(m) %>%
summarize(score = mean(score)) %>%
ggplot(aes(x = m %>% as.numeric(), y = score)) + geom_line() +
scale_x_continuous(breaks = 1:16, minor_breaks = NULL)
ggplot(scores %>%
arrange(branch, m) %>%
group_by(branch) %>%
mutate(first_m = first(m)) %>%
ungroup() %>%
arrange(first_m) %>%
mutate(branch = branch %>% factor(., unique(branch))),
aes(x = m, y = branch, fill = score)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "steelblue")
ggplot(scores,
aes(x = m, y = branch, fill = branch, alpha = score)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "steelblue")
ggplot(scores,
aes(x = m, y = branch, fill = branch %>% factor(), alpha = score)) +
geom_tile()
ggplot(scores,
aes(x = m, y = branch, fill = branch %>% factor(), alpha = score)) +
geom_tile() +
scale_alpha(range = c(0,1))
ggplot(scores,
aes(x = m, y = branch, fill = branch %>% factor(), alpha = score)) +
geom_tile() +
scale_alpha(range = c(0,1)) +
guides(fill = FALSE, alpha = FALSE)
ggplot(scores,
aes(x = m, y = branch, fill = branch %>% factor(), alpha = score %>% log())) +
geom_tile() +
scale_alpha(range = c(0,1)) +
guides(fill = FALSE, alpha = FALSE)
ggplot(scores,
aes(x = m %>% as.numeric(), y = score %>% log(), col = branch %>% factor())) +
geom_line()
ggplot(scores,
aes(x = m, y = branch, fill = branch %>% factor(), alpha = score %>% log())) +
geom_tile() +
scale_alpha(range = c(0,1)) +
guides(fill = FALSE, alpha = FALSE)
ggplot(scores,
aes(x = m %>% as.numeric(), y = score %>% log(), col = branch %>% factor())) +
geom_line()
ggplot(scores,
aes(x = m %>% as.numeric(), y = score, col = branch %>% factor())) +
geom_line()
ggplot(scores,
aes(x = m %>% as.numeric(), y = score %>% log(), col = branch %>% factor())) +
geom_line()
source("R_LSY/align_topics_all_functions.R")
